<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Something interesting for sure...">

  <title>Nyami - VueJs and ASP.NET Core - Part 2</title>

  <link rel="canonical" href="https://www.nyami.uk/posts/2019-05-21-vuewithaspnetpart2">

      <link type="application/rss+xml" rel="alternate" href="/feed.rss" />
      <link type="application/atom+xml" rel="alternate" href="/feed.atom" />
  
  <meta name="application-name" content="Nyami" />
  <meta name="msapplication-tooltip" content="Nyami" />
  <meta name="msapplication-starturl" content="/" />

  <meta property="og:title" content="Nyami - VueJs and ASP.NET Core - Part 2" />
    <meta property="og:image" content="/images/VueLogo.png" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.nyami.uk/posts/2019-05-21-vuewithaspnetpart2" />
  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <!-- Bootstrap core CSS -->
  <link href="/vendor/bootstrap/scss/bootstrap.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="/vendor/fontawesome-free/css/brands.min.css" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css' data-no-mirror>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css' data-no-mirror>
  
  <!-- Custom styles for this template -->
  <link href="/scss/clean-blog.css" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.0.0/dist/quicklink.umd.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/themes/prism.css">

  <!-- Lunr search -->
  
  


  

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">Nyami</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="/posts">Posts</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/tags"></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/tags">Tags</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/about">About Me</a>
            </li>
</ul>
    </div>
  </div>
</nav>

  <!-- Page Header -->
  <header class="masthead" style="background-image: url(&quot;/images/VueLogo.png&quot;)">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="post-heading">
          <h1>
            VueJs and ASP.NET Core - Part 2
          </h1>
              <div class="meta">Published on Tuesday, 21 May 2019</div>
                <div class="mt-3">
                      <a href="/tags/aspnet" class="badge badge-light"> aspnet</a>
                      <a href="/tags/dotnet" class="badge badge-light"> dotnet</a>
                      <a href="/tags/vuejs" class="badge badge-light"> VueJs</a>
                </div>
        </div>
      </div>
    </div>
  </div>
</header>

  <!-- Main Content -->
  <div class="container"> 
    <div class="row">
      <div id="content" class="col-md-12">  
        <p>In <a href="/posts/2019-05-10-VueWithAspNetPart1">Part 1</a> we looked at the Angular project template with ASP.NET Core and its pretty much what we want to achieve for VueJs. In this part we'll dig a little deeper into <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.spaservices?view=aspnetcore-2.2">Microsoft.AspNetCore.SpaServices</a>, specifically <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.spaservices.angularcli?view=aspnetcore-2.2">Microsoft.AspNetCore.SpaServices.AngularCli</a> and look to take inspiration for our Vue solution.</p>
<!--more-->
<h2 id="vue-create">vue create</h2>
<p>Let's start out by trying to use the template created for Angular and swap out the ClientApp for our VueJs app and see what happens.
First we'll create our VueJs application, to do this we'll use the <a href="https://cli.vuejs.org/">Vue CLI</a>, I've used npm to install this as a global tool (<code>npm install -g &#64;vue/cli</code>), so it just a case of typing <code> vue create hello-world</code>, where hello-world is the name of your project, at a suitable location in your favourite command prompt. You'll then be prompted a present, I opted for manually selecting feature and chose:</p>
<ol>
<li>Babel, TypeScript, Linter/Formatter</li>
<li>Yes to Use class-style component syntax</li>
<li>Yes to Use Babel alongside TypeScript for auto-detected polyfills</li>
<li>TSLint as linter/formatter config</li>
<li>Lint on save</li>
<li>Config in dedicated config files</li>
</ol>
<p>We can have a look at our newly created site if we navigate into the folder and perform an <code>npm install</code> before running <code>npm run serve</code>, nothing exciting but it should all work.</p>
<h2 id="dotnet-new">dotnet new</h2>
<p>Next, we'll create an ASP.NET app using the Angular project template, again, at a suitable location in your favourite command prompt, type <code>dotnet new angular</code>. We can open the project and run this in Visual Studio, and as if by magic we have an Angular app running from our ASP.NET project. If we take a look at the build output we should be able to see that an 'npm install' was initiated, this was from the additional target 'DebugEnsureNodeEnv’ in our project file, and if you look though the output for “ASP.NET Core Web Server” you should see that 'ng serve' was called, this call was initiated by the <code>spa.UseAngularCliServer(npmScript: &quot;start&quot;)</code> call in our startup.cs.</p>
<h2 id="bait-and-switch">bait and switch</h2>
<p>Now let's replace the Angular ClientApp folder with the contents from the VueJs app created above, and the change the npmScript called by <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.spaservices.angularcli.angularclimiddlewareextensions.useangularcliserver?view=aspnetcore-2.2">spa.UseAngularCliServer</a> in Startup.cs from &quot;start&quot; to &quot;serve&quot; and see what happens when we run the ASP.NET app.</p>
<h2 id="fail">fail</h2>
<p>Hmmmm.... not much, just the following exception:</p>
<pre><code>TimeoutException: The Angular CLI process did not start listening for requests within the timeout period of 50 seconds.
</code></pre>
<p>But if we take another look at the outputs, we can see that our project has installed the npm packages and has actually started our Vue application on a random port, it would appear that the middleware just hasn't hooked everything up. Thankfully Microsoft has open sourced ASP.NET Core and much of the supporting packages so it doesn’t take much to rummage around the source code for <a href="https://github.com/aspnet/AspNetCore/tree/master/src/Middleware/SpaServices.Extensions/src/AngularCli">AngularCliMiddleware</a> to realise that the magic to hook everything up is simply a regular expression looking for the confirmation from the Angular CLI output.</p>
<h2 id="vueclimiddleware">VueCliMiddleware</h2>
<p>So let's create our own middleware for Vue, looking though the source code it should be just a case of cloning the AngularCliMiddleware along with the internal supporting classes (unless of course you want to get creative with reflection) and use an appropriate regular expression to capture the Vue CLI start up.</p>
<ol>
<li>Create a new, empty class lib project</li>
<li>Add a package reference to <a href="https://www.nuget.org/packages/Microsoft.AspNetCore.SpaServices.Extensions/2.2.0">Microsoft.AspNetCore.SpaServices.Extensions (2.2.0)</a></li>
<li>Copy AngularCliBuilder.cs, AngularCliMiddleware.cs and AngularCliMiddlewareExtensions.cs and supporting internal classes from <a href="https://github.com/aspnet/AspNetCore">https://github.com/aspnet/AspNetCore</a></li>
<li>Rename all the things</li>
<li>Replace openBrowserLine Regex with a suitable Vue alternative, I went for <code>&quot; - Local: (http\\S+)&quot;</code></li>
</ol>
<p>You can now reference this project in any project created from the Angular template after swapping out the Angular ClientApp with you Vue ClientApp and simply change the <code>spa.UseAngularCliServer(npmScript: &quot;start&quot;)</code> with <code>spa.UseVueCliServer(npmScript: &quot;serve&quot;);</code></p>
<h2 id="heres-one-i-made-earlier">Here's one I made earlier</h2>
<p>You can check out the version I knocked up <a href="https://github.com/Nyami/AspNetCore.VueCliServices">here</a>, this has also been uploaded to <a href="https://www.nuget.org/packages/Nyami.AspNetCore.VueCliServices">NuGet</a> so you can get started by pulling this into your own project via the package manager UI or the package manager console using <code>Install-Package Nyami.AspNetCore.VueCliServices</code>.</p>
<p>In the <a href="/posts/2019-06-11-VueWithAspNetPart3">next part</a> we'll take a look at creating a project template to get us up and running even quicker.</p>


      </div>
    </div>
  </div>

  <hr>

  <!-- Footer -->  
  <footer>
    <div class="container">
        <div class="row">
                <div class="col-md-12 text-center">
                    <p class="copyright text-muted m-0">Copyright &#xA9; 2022</p>
                    <br />
                    <ul class="list-inline text-center small">
                            <li class="list-inline-item">
                                <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
                            </li>
                            <li class="list-inline-item">
                                <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                            </li>
                    </ul>
                    <br />
                    <div class="font-weight-bold small"><a href="https://statiq.dev">Generated by Statiq</a></div>
                </div>
        </div>
    </div>
</footer>

  <!-- Bootstrap core JavaScript -->
  <script src="/vendor/jquery/jquery.min.js"></script>
  <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  


  

  <!-- Custom scripts for this template -->
  <script src="/js/clean-blog.js"></script>

</body>

</html>
